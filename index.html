<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Echarts</title>
    <script src="echarts.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
    <link rel="stylesheet" href="static/css/zTreeStyle/zTreeStyle.css">
    <link href="https://cdn.bootcss.com/font-awesome/5.8.2/css/all.css" rel="stylesheet">
</head>
<body>

<div id="myTree" class="treeview">

</div>


<div id="jstree"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="static/js/jquery.ztree.all.js"></script>

<script type="text/javascript">

    var testData = [{
        'id':'root',
        'text':'测试案由',
        'icon': 'fa fa-folder',
        'state':{
            'opened':true
        },
        "children": [
            {    //创建一个子节点
            "text": "子节点1",
            "id": "child1"
            },
            {
                "text": "子节点2",
                "id": "child2"
            },
            {
                "text": "子节点3",
                "id": "child3"
            },
        ],
    }]

    $('#myTree').jstree({
        'core':{
            'multiple':false,
            'data': testData,
            'dblclick_toggle': true,
            "check_callback": true,
        }
    })

    function getCurrNode(){
        var ref = $('#myTree').jstree(true);
        var sel = ref.get_selected();
        return sel;
    }

    function createNode(parent_node, new_node_id, new_node_text, position) {
        $('#myTree').jstree('create_node', $(parent_node), { "text":new_node_text, "id":new_node_id }, position, false, false);
    }

    function createNode2(parent_node, new_node, position) {
        $('#myTree').jstree('create_node', $(parent_node), new_node, position, false, false);
    }

    $("#myTree").bind("select_node.jstree", function (e, data) {
        console.log(e);
        console.log(data);
        var currentNode = getCurrNode();
        currentNode = "#"+currentNode[0]
        console.log(currentNode);
        // createNode(currentNode, "childchild2", "子节点4", "last");
        console.log(data.node.parents.length);
        console.log(data.node.children.length);
        if (data.node.parents.length === 2 && data.node.children.length <= 0) {
            axios.get('http://127.0.0.1:8000/equipment/').then(
                function (response) {
                    console.log(response.data);
                    // var tempData = response.data;
                    // childData.push({
                    //     'text': tempData.equipmentid,
                    //     'id': tempData.id,
                    //     'longitude' : tempData.longitude,
                    //     'latitude': tempData.latitude
                    // })
                    for (i = 0; i < response.data.length; i++) {
                        // createNode2(currentNode, childData[i], last);
                        console.log(response.data[i]);
                        console.log(response.data[i].id);
                        console.log(response.data[i].equipmentid)
                        createNode(currentNode, response.data[i].id, response.data[i].equipmentid, "last");
                        debugger
                    }
                }
            )
        }
    });




    // $(function () {
    //     $('#jstree').jstree({
    //         // 'plugins': ["checkbox", "state"],
    //         'core': {
    //             'data': [{
    //                 "id": "root",
    //                 "text": "根节点1",
    //                 "state": {    //默认状态展开
    //                     "opened": true
    //                 },
    //                 "children": [{    //创建一个子节点
    //                     "text": "子节点1",
    //                     "id": "child1"
    //                 }]
    //             }],
    //             'check_callback': true
    //         }
    //     });
    // });
    //
    // $("#jstree").bind("select_node.jstree", function (e, data) {
    //         createNode("#jstree", "root1", "根节点2", "first");   //最前面插入
    //         createNode("#root", "child2", "子节点2", "last");   //在最后插入
    // });
    //
    // //当jsree加载完成会执行如下函数，创建两个节点
    // $('#jstree').on('ready.jstree', function (e, data) {
    //     createNode("#jstree", "root1", "根节点2", "first");   //最前面插入
    //     createNode("#root", "child2", "子节点2", "last");   //在最后插入
    // });

    // API createNode(parent, id, text, position).
    //  parent:在该节点下创建，id： 新节点id， text：新节点文本, position：插入位置
    // 封装一个函数动态创建节点


</script>
</body>
</html>
